<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
        <title>Optimizing SQL Queries</title>
        <meta name="viewport" content="width=device-width">

        <!-- syntax highlighting CSS -->
        <link rel="stylesheet" href="/css/syntax.css">

        <!-- Custom CSS -->
        <link rel="stylesheet" href="/css/main.css">

    </head>
    <body>

        <div class="container">
          <div class="site">
            <div class="header">
              <h1 class="title"><a href="/">Your New Jekyll Site</a></h1>
              <a class="extra" href="/">home</a>
            </div>

                <h2>Optimizing SQL Queries</h2>
<p class="meta">14 Aug 2008</p>

<div class="post">
<div class="css-full-post-content js-full-post-content">
<div></div>I was working on some code when I came across a behemoth of an inline SQL query nestled in the code behind of a page.<br /><br /><!--[if gte mso 9]><xml>  <w:worddocument>   <w:view>Normal</w:View>   <w:zoom>0</w:Zoom>   <w:trackmoves/>   <w:trackformatting/>   <w:punctuationkerning/>   <w:validateagainstschemas/>   <w:saveifxmlinvalid>false</w:SaveIfXMLInvalid>   <w:ignoremixedcontent>false</w:IgnoreMixedContent>   <w:alwaysshowplaceholdertext>false</w:AlwaysShowPlaceholderText>   <w:donotpromoteqf/>   <w:lidthemeother>EN-US</w:LidThemeOther>   <w:lidthemeasian>X-NONE</w:LidThemeAsian>   <w:lidthemecomplexscript>X-NONE</w:LidThemeComplexScript>   <w:compatibility>    <w:breakwrappedtables/>    <w:snaptogridincell/>    <w:wraptextwithpunct/>    <w:useasianbreakrules/>    <w:dontgrowautofit/>    <w:splitpgbreakandparamark/>    <w:dontvertaligncellwithsp/>    <w:dontbreakconstrainedforcedtables/>    <w:dontvertalignintxbx/>    <w:word11kerningpairs/>    <w:cachedcolbalance/>   </w:Compatibility>   <w:browserlevel>MicrosoftInternetExplorer4</w:BrowserLevel>   <m:mathpr>    <m:mathfont val="Cambria Math">    <m:brkbin val="before">    <m:brkbinsub val="&#45;-">    <m:smallfrac val="off">    <m:dispdef/>    <m:lmargin val="0">    <m:rmargin val="0">    <m:defjc val="centerGroup">    <m:wrapindent val="1440">    <m:intlim val="subSup">    <m:narylim val="undOvr">   </m:mathPr></w:WordDocument> </xml><![endif]--><!--[if gte mso 9]><xml>  <w:latentstyles deflockedstate="false" defunhidewhenused="true" defsemihidden="true" defqformat="false" defpriority="99" latentstylecount="267">   <w:lsdexception locked="false" priority="0" semihidden="false" unhidewhenused="false" qformat="true" name="Normal">   <w:lsdexception locked="false" priority="9" semihidden="false" unhidewhenused="false" qformat="true" name="heading 1">   <w:lsdexception locked="false" priority="9" qformat="true" name="heading 2">   <w:lsdexception locked="false" priority="9" qformat="true" name="heading 3">   <w:lsdexception locked="false" priority="9" qformat="true" name="heading 4">   <w:lsdexception locked="false" priority="9" qformat="true" name="heading 5">   <w:lsdexception locked="false" priority="9" qformat="true" name="heading 6">   <w:lsdexception locked="false" priority="9" qformat="true" name="heading 7">   <w:lsdexception locked="false" priority="9" qformat="true" name="heading 8">   <w:lsdexception locked="false" priority="9" qformat="true" name="heading 9">   <w:lsdexception locked="false" priority="39" name="toc 1">   <w:lsdexception locked="false" priority="39" name="toc 2">   <w:lsdexception locked="false" priority="39" name="toc 3">   <w:lsdexception locked="false" priority="39" name="toc 4">   <w:lsdexception locked="false" priority="39" name="toc 5">   <w:lsdexception locked="false" priority="39" name="toc 6">   <w:lsdexception locked="false" priority="39" name="toc 7">   <w:lsdexception locked="false" priority="39" name="toc 8">   <w:lsdexception locked="false" priority="39" name="toc 9">   <w:lsdexception locked="false" priority="35" qformat="true" name="caption">   <w:lsdexception locked="false" priority="10" semihidden="false" unhidewhenused="false" qformat="true" name="Title">   <w:lsdexception locked="false" priority="1" name="Default Paragraph Font">   <w:lsdexception locked="false" priority="11" semihidden="false" unhidewhenused="false" qformat="true" name="Subtitle">   <w:lsdexception locked="false" priority="22" semihidden="false" unhidewhenused="false" qformat="true" name="Strong">   <w:lsdexception locked="false" priority="20" semihidden="false" unhidewhenused="false" qformat="true" name="Emphasis">   <w:lsdexception locked="false" priority="59" semihidden="false" unhidewhenused="false" name="Table Grid">   <w:lsdexception locked="false" unhidewhenused="false" name="Placeholder Text">   <w:lsdexception locked="false" priority="1" semihidden="false" unhidewhenused="false" qformat="true" name="No Spacing">   <w:lsdexception locked="false" priority="60" semihidden="false" unhidewhenused="false" name="Light Shading">   <w:lsdexception locked="false" priority="61" semihidden="false" unhidewhenused="false" name="Light List">   <w:lsdexception locked="false" priority="62" semihidden="false" unhidewhenused="false" name="Light Grid">   <w:lsdexception locked="false" priority="63" semihidden="false" unhidewhenused="false" name="Medium Shading 1">   <w:lsdexception locked="false" priority="64" semihidden="false" unhidewhenused="false" name="Medium Shading 2">   <w:lsdexception locked="false" priority="65" semihidden="false" unhidewhenused="false" name="Medium List 1">   <w:lsdexception locked="false" priority="66" semihidden="false" unhidewhenused="false" name="Medium List 2">   <w:lsdexception locked="false" priority="67" semihidden="false" unhidewhenused="false" name="Medium Grid 1">   <w:lsdexception locked="false" priority="68" semihidden="false" unhidewhenused="false" name="Medium Grid 2">   <w:lsdexception locked="false" priority="69" semihidden="false" unhidewhenused="false" name="Medium Grid 3">   <w:lsdexception locked="false" priority="70" semihidden="false" unhidewhenused="false" name="Dark List">   <w:lsdexception locked="false" priority="71" semihidden="false" unhidewhenused="false" name="Colorful Shading">   <w:lsdexception locked="false" priority="72" semihidden="false" unhidewhenused="false" name="Colorful List">   <w:lsdexception locked="false" priority="73" semihidden="false" unhidewhenused="false" name="Colorful Grid">   <w:lsdexception locked="false" priority="60" semihidden="false" unhidewhenused="false" name="Light Shading Accent 1">   <w:lsdexception locked="false" priority="61" semihidden="false" unhidewhenused="false" name="Light List Accent 1">   <w:lsdexception locked="false" priority="62" semihidden="false" unhidewhenused="false" name="Light Grid Accent 1">   <w:lsdexception locked="false" priority="63" semihidden="false" unhidewhenused="false" name="Medium Shading 1 Accent 1">   <w:lsdexception locked="false" priority="64" semihidden="false" unhidewhenused="false" name="Medium Shading 2 Accent 1">   <w:lsdexception locked="false" priority="65" semihidden="false" unhidewhenused="false" name="Medium List 1 Accent 1">   <w:lsdexception locked="false" unhidewhenused="false" name="Revision">   <w:lsdexception locked="false" priority="34" semihidden="false" unhidewhenused="false" qformat="true" name="List Paragraph">   <w:lsdexception locked="false" priority="29" semihidden="false" unhidewhenused="false" qformat="true" name="Quote">   <w:lsdexception locked="false" priority="30" semihidden="false" unhidewhenused="false" qformat="true" name="Intense Quote">   <w:lsdexception locked="false" priority="66" semihidden="false" unhidewhenused="false" name="Medium List 2 Accent 1">   <w:lsdexception locked="false" priority="67" semihidden="false" unhidewhenused="false" name="Medium Grid 1 Accent 1">   <w:lsdexception locked="false" priority="68" semihidden="false" unhidewhenused="false" name="Medium Grid 2 Accent 1">   <w:lsdexception locked="false" priority="69" semihidden="false" unhidewhenused="false" name="Medium Grid 3 Accent 1">   <w:lsdexception locked="false" priority="70" semihidden="false" unhidewhenused="false" name="Dark List Accent 1">   <w:lsdexception locked="false" priority="71" semihidden="false" unhidewhenused="false" name="Colorful Shading Accent 1">   <w:lsdexception locked="false" priority="72" semihidden="false" unhidewhenused="false" name="Colorful List Accent 1">   <w:lsdexception locked="false" priority="73" semihidden="false" unhidewhenused="false" name="Colorful Grid Accent 1">   <w:lsdexception locked="false" priority="60" semihidden="false" unhidewhenused="false" name="Light Shading Accent 2">   <w:lsdexception locked="false" priority="61" semihidden="false" unhidewhenused="false" name="Light List Accent 2">   <w:lsdexception locked="false" priority="62" semihidden="false" unhidewhenused="false" name="Light Grid Accent 2">   <w:lsdexception locked="false" priority="63" semihidden="false" unhidewhenused="false" name="Medium Shading 1 Accent 2">   <w:lsdexception locked="false" priority="64" semihidden="false" unhidewhenused="false" name="Medium Shading 2 Accent 2">   <w:lsdexception locked="false" priority="65" semihidden="false" unhidewhenused="false" name="Medium List 1 Accent 2">   <w:lsdexception locked="false" priority="66" semihidden="false" unhidewhenused="false" name="Medium List 2 Accent 2">   <w:lsdexception locked="false" priority="67" semihidden="false" unhidewhenused="false" name="Medium Grid 1 Accent 2">   <w:lsdexception locked="false" priority="68" semihidden="false" unhidewhenused="false" name="Medium Grid 2 Accent 2">   <w:lsdexception locked="false" priority="69" semihidden="false" unhidewhenused="false" name="Medium Grid 3 Accent 2">   <w:lsdexception locked="false" priority="70" semihidden="false" unhidewhenused="false" name="Dark List Accent 2">   <w:lsdexception locked="false" priority="71" semihidden="false" unhidewhenused="false" name="Colorful Shading Accent 2">   <w:lsdexception locked="false" priority="72" semihidden="false" unhidewhenused="false" name="Colorful List Accent 2">   <w:lsdexception locked="false" priority="73" semihidden="false" unhidewhenused="false" name="Colorful Grid Accent 2">   <w:lsdexception locked="false" priority="60" semihidden="false" unhidewhenused="false" name="Light Shading Accent 3">   <w:lsdexception locked="false" priority="61" semihidden="false" unhidewhenused="false" name="Light List Accent 3">   <w:lsdexception locked="false" priority="62" semihidden="false" unhidewhenused="false" name="Light Grid Accent 3">   <w:lsdexception locked="false" priority="63" semihidden="false" unhidewhenused="false" name="Medium Shading 1 Accent 3">   <w:lsdexception locked="false" priority="64" semihidden="false" unhidewhenused="false" name="Medium Shading 2 Accent 3">   <w:lsdexception locked="false" priority="65" semihidden="false" unhidewhenused="false" name="Medium List 1 Accent 3">   <w:lsdexception locked="false" priority="66" semihidden="false" unhidewhenused="false" name="Medium List 2 Accent 3">   <w:lsdexception locked="false" priority="67" semihidden="false" unhidewhenused="false" name="Medium Grid 1 Accent 3">   <w:lsdexception locked="false" priority="68" semihidden="false" unhidewhenused="false" name="Medium Grid 2 Accent 3">   <w:lsdexception locked="false" priority="69" semihidden="false" unhidewhenused="false" name="Medium Grid 3 Accent 3">   <w:lsdexception locked="false" priority="70" semihidden="false" unhidewhenused="false" name="Dark List Accent 3">   <w:lsdexception locked="false" priority="71" semihidden="false" unhidewhenused="false" name="Colorful Shading Accent 3">   <w:lsdexception locked="false" priority="72" semihidden="false" unhidewhenused="false" name="Colorful List Accent 3">   <w:lsdexception locked="false" priority="73" semihidden="false" unhidewhenused="false" name="Colorful Grid Accent 3">   <w:lsdexception locked="false" priority="60" semihidden="false" unhidewhenused="false" name="Light Shading Accent 4">   <w:lsdexception locked="false" priority="61" semihidden="false" unhidewhenused="false" name="Light List Accent 4">   <w:lsdexception locked="false" priority="62" semihidden="false" unhidewhenused="false" name="Light Grid Accent 4">   <w:lsdexception locked="false" priority="63" semihidden="false" unhidewhenused="false" name="Medium Shading 1 Accent 4">   <w:lsdexception locked="false" priority="64" semihidden="false" unhidewhenused="false" name="Medium Shading 2 Accent 4">   <w:lsdexception locked="false" priority="65" semihidden="false" unhidewhenused="false" name="Medium List 1 Accent 4">   <w:lsdexception locked="false" priority="66" semihidden="false" unhidewhenused="false" name="Medium List 2 Accent 4">   <w:lsdexception locked="false" priority="67" semihidden="false" unhidewhenused="false" name="Medium Grid 1 Accent 4">   <w:lsdexception locked="false" priority="68" semihidden="false" unhidewhenused="false" name="Medium Grid 2 Accent 4">   <w:lsdexception locked="false" priority="69" semihidden="false" unhidewhenused="false" name="Medium Grid 3 Accent 4">   <w:lsdexception locked="false" priority="70" semihidden="false" unhidewhenused="false" name="Dark List Accent 4">   <w:lsdexception locked="false" priority="71" semihidden="false" unhidewhenused="false" name="Colorful Shading Accent 4">   <w:lsdexception locked="false" priority="72" semihidden="false" unhidewhenused="false" name="Colorful List Accent 4">   <w:lsdexception locked="false" priority="73" semihidden="false" unhidewhenused="false" name="Colorful Grid Accent 4">   <w:lsdexception locked="false" priority="60" semihidden="false" unhidewhenused="false" name="Light Shading Accent 5">   <w:lsdexception locked="false" priority="61" semihidden="false" unhidewhenused="false" name="Light List Accent 5">   <w:lsdexception locked="false" priority="62" semihidden="false" unhidewhenused="false" name="Light Grid Accent 5">   <w:lsdexception locked="false" priority="63" semihidden="false" unhidewhenused="false" name="Medium Shading 1 Accent 5">   <w:lsdexception locked="false" priority="64" semihidden="false" unhidewhenused="false" name="Medium Shading 2 Accent 5">   <w:lsdexception locked="false" priority="65" semihidden="false" unhidewhenused="false" name="Medium List 1 Accent 5">   <w:lsdexception locked="false" priority="66" semihidden="false" unhidewhenused="false" name="Medium List 2 Accent 5">   <w:lsdexception locked="false" priority="67" semihidden="false" unhidewhenused="false" name="Medium Grid 1 Accent 5">   <w:lsdexception locked="false" priority="68" semihidden="false" unhidewhenused="false" name="Medium Grid 2 Accent 5">   <w:lsdexception locked="false" priority="69" semihidden="false" unhidewhenused="false" name="Medium Grid 3 Accent 5">   <w:lsdexception locked="false" priority="70" semihidden="false" unhidewhenused="false" name="Dark List Accent 5">   <w:lsdexception locked="false" priority="71" semihidden="false" unhidewhenused="false" name="Colorful Shading Accent 5">   <w:lsdexception locked="false" priority="72" semihidden="false" unhidewhenused="false" name="Colorful List Accent 5">   <w:lsdexception locked="false" priority="73" semihidden="false" unhidewhenused="false" name="Colorful Grid Accent 5">   <w:lsdexception locked="false" priority="60" semihidden="false" unhidewhenused="false" name="Light Shading Accent 6">   <w:lsdexception locked="false" priority="61" semihidden="false" unhidewhenused="false" name="Light List Accent 6">   <w:lsdexception locked="false" priority="62" semihidden="false" unhidewhenused="false" name="Light Grid Accent 6">   <w:lsdexception locked="false" priority="63" semihidden="false" unhidewhenused="false" name="Medium Shading 1 Accent 6">   <w:lsdexception locked="false" priority="64" semihidden="false" unhidewhenused="false" name="Medium Shading 2 Accent 6">   <w:lsdexception locked="false" priority="65" semihidden="false" unhidewhenused="false" name="Medium List 1 Accent 6">   <w:lsdexception locked="false" priority="66" semihidden="false" unhidewhenused="false" name="Medium List 2 Accent 6">   <w:lsdexception locked="false" priority="67" semihidden="false" unhidewhenused="false" name="Medium Grid 1 Accent 6">   <w:lsdexception locked="false" priority="68" semihidden="false" unhidewhenused="false" name="Medium Grid 2 Accent 6">   <w:lsdexception locked="false" priority="69" semihidden="false" unhidewhenused="false" name="Medium Grid 3 Accent 6">   <w:lsdexception locked="false" priority="70" semihidden="false" unhidewhenused="false" name="Dark List Accent 6">   <w:lsdexception locked="false" priority="71" semihidden="false" unhidewhenused="false" name="Colorful Shading Accent 6">   <w:lsdexception locked="false" priority="72" semihidden="false" unhidewhenused="false" name="Colorful List Accent 6">   <w:lsdexception locked="false" priority="73" semihidden="false" unhidewhenused="false" name="Colorful Grid Accent 6">   <w:lsdexception locked="false" priority="19" semihidden="false" unhidewhenused="false" qformat="true" name="Subtle Emphasis">   <w:lsdexception locked="false" priority="21" semihidden="false" unhidewhenused="false" qformat="true" name="Intense Emphasis">   <w:lsdexception locked="false" priority="31" semihidden="false" unhidewhenused="false" qformat="true" name="Subtle Reference">   <w:lsdexception locked="false" priority="32" semihidden="false" unhidewhenused="false" qformat="true" name="Intense Reference">   <w:lsdexception locked="false" priority="33" semihidden="false" unhidewhenused="false" qformat="true" name="Book Title">   <w:lsdexception locked="false" priority="37" name="Bibliography">   <w:lsdexception locked="false" priority="39" qformat="true" name="TOC Heading">  </w:LatentStyles> </xml><![endif]--><style> <!--  /* Font Definitions */  @font-face  {font-family:"Cambria Math";  panose-1:2 4 5 3 5 4 6 3 2 4;  mso-font-charset:1;  mso-generic-font-family:roman;  mso-font-format:other;  mso-font-pitch:variable;  mso-font-signature:0 0 0 0 0 0;} @font-face  {font-family:Calibri;  panose-1:2 15 5 2 2 2 4 3 2 4;  mso-font-charset:0;  mso-generic-font-family:swiss;  mso-font-pitch:variable;  mso-font-signature:-1610611985 1073750139 0 0 159 0;}  /* Style Definitions */  p.MsoNormal, li.MsoNormal, div.MsoNormal  {mso-style-unhide:no;  mso-style-qformat:yes;  mso-style-parent:"";  margin-top:0cm;  margin-right:0cm;  margin-bottom:10.0pt;  margin-left:0cm;  line-height:115%;  mso-pagination:widow-orphan;  font-size:11.0pt;  font-family:"Calibri","sans-serif";  mso-ascii-font-family:Calibri;  mso-ascii-theme-font:minor-latin;  mso-fareast-font-family:Calibri;  mso-fareast-theme-font:minor-latin;  mso-hansi-font-family:Calibri;  mso-hansi-theme-font:minor-latin;  mso-bidi-font-family:"Times New Roman";  mso-bidi-theme-font:minor-bidi;} .MsoChpDefault  {mso-style-type:export-only;  mso-default-props:yes;  mso-ascii-font-family:Calibri;  mso-ascii-theme-font:minor-latin;  mso-fareast-font-family:Calibri;  mso-fareast-theme-font:minor-latin;  mso-hansi-font-family:Calibri;  mso-hansi-theme-font:minor-latin;  mso-bidi-font-family:"Times New Roman";  mso-bidi-theme-font:minor-bidi;} .MsoPapDefault  {mso-style-type:export-only;  margin-bottom:10.0pt;  line-height:115%;} @page Section1  {size:612.0pt 792.0pt;  margin:72.0pt 72.0pt 72.0pt 72.0pt;  mso-header-margin:35.4pt;  mso-footer-margin:35.4pt;  mso-paper-source:0;} div.Section1  {page:Section1;} --> </style><!--[if gte mso 10]> <style>  /* Style Definitions */  table.MsoNormalTable  {mso-style-name:"Table Normal";  mso-tstyle-rowband-size:0;  mso-tstyle-colband-size:0;  mso-style-noshow:yes;  mso-style-priority:99;  mso-style-qformat:yes;  mso-style-parent:"";  mso-padding-alt:0cm 5.4pt 0cm 5.4pt;  mso-para-margin-top:0cm;  mso-para-margin-right:0cm;  mso-para-margin-bottom:10.0pt;  mso-para-margin-left:0cm;  line-height:115%;  mso-pagination:widow-orphan;  font-size:11.0pt;  font-family:"Calibri","sans-serif";  mso-ascii-font-family:Calibri;  mso-ascii-theme-font:minor-latin;  mso-fareast-font-family:"Times New Roman";  mso-fareast-theme-font:minor-fareast;  mso-hansi-font-family:Calibri;  mso-hansi-theme-font:minor-latin;} </style> <![endif]-->  <p class="MsoNormal" style="margin-bottom: 0.0001pt; line-height: normal;"><span style="font-size: 10pt; font-family: &quot;Courier New&quot;; color: blue;">Select</span><span style="font-size: 10pt; font-family: &quot;Courier New&quot;;"> a<span style="color: gray;">.</span>list_id<span style="color: gray;">,</span> a<span style="color: gray;">.</span>company_name<span style="color: gray;">,</span> a<span style="color: gray;">.</span>company_description<span style="color: gray;">,</span> a<span style="color: gray;">.</span>url<span style="color: gray;">,</span> <o:p></o:p></span></p>  <p class="MsoNormal" style="margin-bottom: 0.0001pt; line-height: normal;"><span style="font-size: 10pt; font-family: &quot;Courier New&quot;; color: gray;">(</span><span style="font-size: 10pt; font-family: &quot;Courier New&quot;;"> <span style="color: blue;">case</span> <span style="color: blue;">when</span> <span style="color: gray;">(</span><span style="color: blue;">Select</span> <span style="color: fuchsia;">upper</span><span style="color: gray;">(</span>County_Name<span style="color: gray;">)</span> <span style="color: blue;">from</span> tbl_County <span style="color: blue;">where</span> County_id<span style="color: gray;">=</span>a<span style="color: gray;">.</span>County_id<span style="color: gray;">)</span> <span style="color: gray;">is</span> <span style="color: gray;">null</span> <span style="color: blue;">then</span> <o:p></o:p></span></p>  <p class="MsoNormal" style="margin-bottom: 0.0001pt; line-height: normal;"><span style="font-size: 10pt; font-family: &quot;Courier New&quot;;"><span style="">      </span><span style="color: gray;">(</span><span style="color: blue;">Select</span> <span style="color: fuchsia;">upper</span><span style="color: gray;">(</span>Country_Name<span style="color: gray;">)</span> <span style="color: blue;">from</span> tbl_description_Country <span style="color: blue;">where</span> Country_id<span style="color: gray;">=</span> a<span style="color: gray;">.</span>Country_id<span style="color: gray;">)</span> <o:p></o:p></span></p>  <p class="MsoNormal" style="margin-bottom: 0.0001pt; line-height: normal;"><span style="font-size: 10pt; font-family: &quot;Courier New&quot;;"><span style=""> </span><span style="color: blue;">else</span> <o:p></o:p></span></p>  <p class="MsoNormal" style="margin-bottom: 0.0001pt; line-height: normal;"><span style="font-size: 10pt; font-family: &quot;Courier New&quot;;"><span style="">      </span><span style="color: gray;">(</span><span style="color: blue;">Select</span> <span style="color: fuchsia;">upper</span><span style="color: gray;">(</span>County_Name<span style="color: gray;">)</span> <span style="color: blue;">from</span> tbl_County <span style="color: blue;">where</span> County_id<span style="color: gray;">=</span> a<span style="color: gray;">.</span>County_id<span style="color: gray;">)</span> <span style="color: blue;">end</span> <span style="color: gray;">)</span> <o:p></o:p></span></p>  <p class="MsoNormal" style="margin-bottom: 0.0001pt; line-height: normal;"><span style="font-size: 10pt; font-family: &quot;Courier New&quot;;"><span style=""> </span><span style="color: blue;">as</span> County_name<span style="color: gray;">,</span> <o:p></o:p></span></p>  <p class="MsoNormal" style="margin-bottom: 0.0001pt; line-height: normal;"><span style="font-size: 10pt; font-family: &quot;Courier New&quot;;">b<span style="color: gray;">.</span>review_approval<span style="color: gray;">,</span> <o:p></o:p></span></p>  <p class="MsoNormal" style="margin-bottom: 0.0001pt; line-height: normal;"><span style="font-size: 10pt; font-family: &quot;Courier New&quot;;"><span style=""> </span><span style="color: gray;">(</span> <span style="color: blue;">case</span> <span style="color: blue;">when</span> <span style="color: gray;">(</span><span style="color: blue;">Select</span> county_id <span style="color: blue;">from</span> tbl_County <span style="color: blue;">where</span> County_id <span style="color: gray;">=</span> a<span style="color: gray;">.</span>County_id<span style="color: gray;">)=</span> 0 <span style="color: blue;">then<o:p></o:p></span></span></p>  <p class="MsoNormal" style="margin-bottom: 0.0001pt; line-height: normal;"><span style="font-size: 10pt; font-family: &quot;Courier New&quot;;"><span style="">      </span><span style="color: gray;">(</span><span style="color: blue;">Select</span> Country_id <span style="color: blue;">from</span> tbl_description_Country <span style="color: blue;">where</span> Country_id <span style="color: gray;">=</span> a<span style="color: gray;">.</span>Country_id<span style="color: gray;">)</span> <o:p></o:p></span></p>  <p class="MsoNormal" style="margin-bottom: 0.0001pt; line-height: normal;"><span style="font-size: 10pt; font-family: &quot;Courier New&quot;;"><span style=""> </span><span style="color: blue;">else</span> <o:p></o:p></span></p>  <p class="MsoNormal" style="margin-bottom: 0.0001pt; line-height: normal;"><span style="font-size: 10pt; font-family: &quot;Courier New&quot;;"><span style="">      </span><span style="color: gray;">(</span><span style="color: blue;">Select</span> county_id <span style="color: blue;">from</span> tbl_County <span style="color: blue;">where</span> County_id<span style="color: gray;">=</span> a<span style="color: gray;">.</span>County_id<span style="color: gray;">)</span> <span style="color: blue;">end</span> <span style="color: gray;">)</span> <o:p></o:p></span></p>  <p class="MsoNormal" style="margin-bottom: 0.0001pt; line-height: normal;"><span style="font-size: 10pt; font-family: &quot;Courier New&quot;;"><span style=""> </span><span style="color: blue;">as</span> CountryID<span style="color: gray;">,<o:p></o:p></span></span></p>  <p class="MsoNormal" style="margin-bottom: 0.0001pt; line-height: normal;"><span style="font-size: 10pt; font-family: &quot;Courier New&quot;;"><span style=""> </span>dbo<span style="color: gray;">.</span>funcGetRatingSum <span style="color: gray;">(</span>a<span style="color: gray;">.</span>list_id<span style="color: gray;">)</span> <span style="color: blue;">as</span> ratingSum<span style="color: gray;">,</span> <o:p></o:p></span></p>  <p class="MsoNormal" style="margin-bottom: 0.0001pt; line-height: normal;"><span style="font-size: 10pt; font-family: &quot;Courier New&quot;;"><span style=""> </span>dbo<span style="color: gray;">.</span>funcGetRatingCount <span style="color: gray;">(</span>a<span style="color: gray;">.</span>list_id<span style="color: gray;">)</span> <span style="color: blue;">as</span> totalCount<span style="color: gray;">,</span> <o:p></o:p></span></p>  <p class="MsoNormal" style="margin-bottom: 0.0001pt; line-height: normal;"><span style="font-size: 10pt; font-family: &quot;Courier New&quot;;"><span style=""> </span><span style="color: gray;">(</span><span style="color: blue;">Select</span> <span style="color: blue;">case</span> <span style="color: blue;">when</span> <span style="color: gray;">(</span><span style="color: blue;">select</span> <span style="color: blue;">top</span> 1 banner_path <span style="color: blue;">from</span> tbl_banners <span style="color: blue;">where</span> list_id <span style="color: gray;">=</span> a<span style="color: gray;">.</span>list_id<span style="">  </span><span style="color: gray;">and</span> a<span style="color: gray;">.</span>subscription_id <span style="color: gray;">=</span> 2<span style="color: gray;">)</span> <span style="color: gray;">is</span> <span style="color: gray;">null</span> <span style="color: blue;">then</span> <o:p></o:p></span></p>  <p class="MsoNormal" style="margin-bottom: 0.0001pt; line-height: normal;"><span style="font-size: 10pt; font-family: &quot;Courier New&quot;;"><span style="">      </span><span style="color: red;">''</span> <o:p></o:p></span></p>  <p class="MsoNormal" style="margin-bottom: 0.0001pt; line-height: normal;"><span style="font-size: 10pt; font-family: &quot;Courier New&quot;;"><span style=""> </span><span style="color: blue;">else</span> <o:p></o:p></span></p>  <p class="MsoNormal" style="margin-bottom: 0.0001pt; line-height: normal;"><span style="font-size: 10pt; font-family: &quot;Courier New&quot;;"><span style="">      </span><span style="color: gray;">(</span><span style="color: blue;">select</span> <span style="color: blue;">top</span> 1 banner_path <span style="color: blue;">from</span> tbl_banners <span style="color: blue;">where</span> list_id <span style="color: gray;">=</span> a<span style="color: gray;">.</span>list_id<span style="">  </span><span style="color: gray;">and</span> a<span style="color: gray;">.</span>subscription_id <span style="color: gray;">=</span> 2<span style="color: gray;">)</span> <span style="color: blue;">end</span><span style="color: gray;">)</span> <o:p></o:p></span></p>  <p class="MsoNormal" style="margin-bottom: 0.0001pt; line-height: normal;"><span style="font-size: 10pt; font-family: &quot;Courier New&quot;;"><span style=""> </span><span style="color: blue;">as</span> bannerpath <o:p></o:p></span></p>  <p class="MsoNormal" style="margin-bottom: 0.0001pt; line-height: normal;"><span style="font-size: 10pt; font-family: &quot;Courier New&quot;; color: blue;">from</span><span style="font-size: 10pt; font-family: &quot;Courier New&quot;;"> tbl_directorylisting a<span style="color: gray;">,</span> tbl_preferences <span style="color: blue;">as</span> b <span style="color: gray;">,</span> <o:p></o:p></span></p>  <p class="MsoNormal" style="margin-bottom: 0.0001pt; line-height: normal;"><span style="font-size: 10pt; font-family: &quot;Courier New&quot;;"><span style=""> </span>tbl_companymaster c <span style="color: blue;">where</span> a<span style="color: gray;">.</span> status <span style="color: gray;">=</span> 1 <span style="color: gray;">and(</span>a<span style="color: gray;">.</span>company_id <span style="color: gray;">=</span> <o:p></o:p></span></p>  <p class="MsoNormal" style="margin-bottom: 0.0001pt; line-height: normal;"><span style="font-size: 10pt; font-family: &quot;Courier New&quot;;"><span style=""> </span>b<span style="color: gray;">.</span>company_id <span style="color: gray;">And</span> a<span style="color: gray;">.</span>status <span style="color: gray;">=</span> 1<span style="color: gray;">)</span> <span style="color: gray;">and</span> c<span style="color: gray;">.</span>category_id<span style="color: gray;">=</span> @CategoryID</span></p>  <p class="MsoNormal" style="margin-bottom: 0.0001pt; line-height: normal;"><span style="font-size: 10pt; font-family: &quot;Courier New&quot;;"><span style=""> </span><span style="color: gray;">and</span><span style="">  </span>a<span style="color: gray;">.</span>company_id<span style="color: gray;">=</span> c<span style="color: gray;">.</span>company_id <span style="color: gray;">and</span> a<span style="color: gray;">.</span>subscription_id <span style="color: gray;">in</span> <span style="color: gray;">(</span>2<span style="color: gray;">,</span>3<span style="color: gray;">)</span> <span style="color: gray;">and</span> subscription_date <span style="color: gray;">>=</span> <span style="color: gray;">(</span><span style="color: fuchsia;">dateadd</span><span style="color: gray;">(</span><span style="color: fuchsia;">year</span><span style="color: gray;">,-</span>1<span style="color: gray;">,</span><span style="color: fuchsia;">getdate</span><span style="color: gray;">()))</span> <o:p></o:p></span></p>  <p class="MsoNormal"><span style="font-size: 10pt; line-height: 115%; font-family: &quot;Courier New&quot;;"><span style=""> </span><span style="color: blue;">Order</span> <span style="color: blue;">by</span><span style="">  </span>county_name<span style="color: gray;">,</span> a<span style="color: gray;">.</span>subscription_id <span style="color: blue;">asc</span><span style="color: gray;">,</span> a<span style="color: gray;">.</span>date_fee_paid</span></p>  Actually it was within several lines of concatenated text values, and had no formatting whatsoever!. My first intention was try to make it a stored procedure, but doing so I couldn't help but try to optimize it a little. Here's my attempt....<br /><br /><!--[if gte mso 9]><xml>  <w:worddocument>   <w:view>Normal</w:View>   <w:zoom>0</w:Zoom>   <w:trackmoves/>   <w:trackformatting/>   <w:punctuationkerning/>   <w:validateagainstschemas/>   <w:saveifxmlinvalid>false</w:SaveIfXMLInvalid>   <w:ignoremixedcontent>false</w:IgnoreMixedContent>   <w:alwaysshowplaceholdertext>false</w:AlwaysShowPlaceholderText>   <w:donotpromoteqf/>   <w:lidthemeother>EN-US</w:LidThemeOther>   <w:lidthemeasian>X-NONE</w:LidThemeAsian>   <w:lidthemecomplexscript>X-NONE</w:LidThemeComplexScript>   <w:compatibility>    <w:breakwrappedtables/>    <w:snaptogridincell/>    <w:wraptextwithpunct/>    <w:useasianbreakrules/>    <w:dontgrowautofit/>    <w:splitpgbreakandparamark/>    <w:dontvertaligncellwithsp/>    <w:dontbreakconstrainedforcedtables/>    <w:dontvertalignintxbx/>    <w:word11kerningpairs/>    <w:cachedcolbalance/>   </w:Compatibility>   <w:browserlevel>MicrosoftInternetExplorer4</w:BrowserLevel>   <m:mathpr>    <m:mathfont val="Cambria Math">    <m:brkbin val="before">    <m:brkbinsub val="&#45;-">    <m:smallfrac val="off">    <m:dispdef/>    <m:lmargin val="0">    <m:rmargin val="0">    <m:defjc val="centerGroup">    <m:wrapindent val="1440">    <m:intlim val="subSup">    <m:narylim val="undOvr">   </m:mathPr></w:WordDocument> </xml><![endif]--><!--[if gte mso 9]><xml>  <w:latentstyles deflockedstate="false" defunhidewhenused="true" defsemihidden="true" defqformat="false" defpriority="99" latentstylecount="267">   <w:lsdexception locked="false" priority="0" semihidden="false" unhidewhenused="false" qformat="true" name="Normal">   <w:lsdexception locked="false" priority="9" semihidden="false" unhidewhenused="false" qformat="true" name="heading 1">   <w:lsdexception locked="false" priority="9" qformat="true" name="heading 2">   <w:lsdexception locked="false" priority="9" qformat="true" name="heading 3">   <w:lsdexception locked="false" priority="9" qformat="true" name="heading 4">   <w:lsdexception locked="false" priority="9" qformat="true" name="heading 5">   <w:lsdexception locked="false" priority="9" qformat="true" name="heading 6">   <w:lsdexception locked="false" priority="9" qformat="true" name="heading 7">   <w:lsdexception locked="false" priority="9" qformat="true" name="heading 8">   <w:lsdexception locked="false" priority="9" qformat="true" name="heading 9">   <w:lsdexception locked="false" priority="39" name="toc 1">   <w:lsdexception locked="false" priority="39" name="toc 2">   <w:lsdexception locked="false" priority="39" name="toc 3">   <w:lsdexception locked="false" priority="39" name="toc 4">   <w:lsdexception locked="false" priority="39" name="toc 5">   <w:lsdexception locked="false" priority="39" name="toc 6">   <w:lsdexception locked="false" priority="39" name="toc 7">   <w:lsdexception locked="false" priority="39" name="toc 8">   <w:lsdexception locked="false" priority="39" name="toc 9">   <w:lsdexception locked="false" priority="35" qformat="true" name="caption">   <w:lsdexception locked="false" priority="10" semihidden="false" unhidewhenused="false" qformat="true" name="Title">   <w:lsdexception locked="false" priority="1" name="Default Paragraph Font">   <w:lsdexception locked="false" priority="11" semihidden="false" unhidewhenused="false" qformat="true" name="Subtitle">   <w:lsdexception locked="false" priority="22" semihidden="false" unhidewhenused="false" qformat="true" name="Strong">   <w:lsdexception locked="false" priority="20" semihidden="false" unhidewhenused="false" qformat="true" name="Emphasis">   <w:lsdexception locked="false" priority="59" semihidden="false" unhidewhenused="false" name="Table Grid">   <w:lsdexception locked="false" unhidewhenused="false" name="Placeholder Text">   <w:lsdexception locked="false" priority="1" semihidden="false" unhidewhenused="false" qformat="true" name="No Spacing">   <w:lsdexception locked="false" priority="60" semihidden="false" unhidewhenused="false" name="Light Shading">   <w:lsdexception locked="false" priority="61" semihidden="false" unhidewhenused="false" name="Light List">   <w:lsdexception locked="false" priority="62" semihidden="false" unhidewhenused="false" name="Light Grid">   <w:lsdexception locked="false" priority="63" semihidden="false" unhidewhenused="false" name="Medium Shading 1">   <w:lsdexception locked="false" priority="64" semihidden="false" unhidewhenused="false" name="Medium Shading 2">   <w:lsdexception locked="false" priority="65" semihidden="false" unhidewhenused="false" name="Medium List 1">   <w:lsdexception locked="false" priority="66" semihidden="false" unhidewhenused="false" name="Medium List 2">   <w:lsdexception locked="false" priority="67" semihidden="false" unhidewhenused="false" name="Medium Grid 1">   <w:lsdexception locked="false" priority="68" semihidden="false" unhidewhenused="false" name="Medium Grid 2">   <w:lsdexception locked="false" priority="69" semihidden="false" unhidewhenused="false" name="Medium Grid 3">   <w:lsdexception locked="false" priority="70" semihidden="false" unhidewhenused="false" name="Dark List">   <w:lsdexception locked="false" priority="71" semihidden="false" unhidewhenused="false" name="Colorful Shading">   <w:lsdexception locked="false" priority="72" semihidden="false" unhidewhenused="false" name="Colorful List">   <w:lsdexception locked="false" priority="73" semihidden="false" unhidewhenused="false" name="Colorful Grid">   <w:lsdexception locked="false" priority="60" semihidden="false" unhidewhenused="false" name="Light Shading Accent 1">   <w:lsdexception locked="false" priority="61" semihidden="false" unhidewhenused="false" name="Light List Accent 1">   <w:lsdexception locked="false" priority="62" semihidden="false" unhidewhenused="false" name="Light Grid Accent 1">   <w:lsdexception locked="false" priority="63" semihidden="false" unhidewhenused="false" name="Medium Shading 1 Accent 1">   <w:lsdexception locked="false" priority="64" semihidden="false" unhidewhenused="false" name="Medium Shading 2 Accent 1">   <w:lsdexception locked="false" priority="65" semihidden="false" unhidewhenused="false" name="Medium List 1 Accent 1">   <w:lsdexception locked="false" unhidewhenused="false" name="Revision">   <w:lsdexception locked="false" priority="34" semihidden="false" unhidewhenused="false" qformat="true" name="List Paragraph">   <w:lsdexception locked="false" priority="29" semihidden="false" unhidewhenused="false" qformat="true" name="Quote">   <w:lsdexception locked="false" priority="30" semihidden="false" unhidewhenused="false" qformat="true" name="Intense Quote">   <w:lsdexception locked="false" priority="66" semihidden="false" unhidewhenused="false" name="Medium List 2 Accent 1">   <w:lsdexception locked="false" priority="67" semihidden="false" unhidewhenused="false" name="Medium Grid 1 Accent 1">   <w:lsdexception locked="false" priority="68" semihidden="false" unhidewhenused="false" name="Medium Grid 2 Accent 1">   <w:lsdexception locked="false" priority="69" semihidden="false" unhidewhenused="false" name="Medium Grid 3 Accent 1">   <w:lsdexception locked="false" priority="70" semihidden="false" unhidewhenused="false" name="Dark List Accent 1">   <w:lsdexception locked="false" priority="71" semihidden="false" unhidewhenused="false" name="Colorful Shading Accent 1">   <w:lsdexception locked="false" priority="72" semihidden="false" unhidewhenused="false" name="Colorful List Accent 1">   <w:lsdexception locked="false" priority="73" semihidden="false" unhidewhenused="false" name="Colorful Grid Accent 1">   <w:lsdexception locked="false" priority="60" semihidden="false" unhidewhenused="false" name="Light Shading Accent 2">   <w:lsdexception locked="false" priority="61" semihidden="false" unhidewhenused="false" name="Light List Accent 2">   <w:lsdexception locked="false" priority="62" semihidden="false" unhidewhenused="false" name="Light Grid Accent 2">   <w:lsdexception locked="false" priority="63" semihidden="false" unhidewhenused="false" name="Medium Shading 1 Accent 2">   <w:lsdexception locked="false" priority="64" semihidden="false" unhidewhenused="false" name="Medium Shading 2 Accent 2">   <w:lsdexception locked="false" priority="65" semihidden="false" unhidewhenused="false" name="Medium List 1 Accent 2">   <w:lsdexception locked="false" priority="66" semihidden="false" unhidewhenused="false" name="Medium List 2 Accent 2">   <w:lsdexception locked="false" priority="67" semihidden="false" unhidewhenused="false" name="Medium Grid 1 Accent 2">   <w:lsdexception locked="false" priority="68" semihidden="false" unhidewhenused="false" name="Medium Grid 2 Accent 2">   <w:lsdexception locked="false" priority="69" semihidden="false" unhidewhenused="false" name="Medium Grid 3 Accent 2">   <w:lsdexception locked="false" priority="70" semihidden="false" unhidewhenused="false" name="Dark List Accent 2">   <w:lsdexception locked="false" priority="71" semihidden="false" unhidewhenused="false" name="Colorful Shading Accent 2">   <w:lsdexception locked="false" priority="72" semihidden="false" unhidewhenused="false" name="Colorful List Accent 2">   <w:lsdexception locked="false" priority="73" semihidden="false" unhidewhenused="false" name="Colorful Grid Accent 2">   <w:lsdexception locked="false" priority="60" semihidden="false" unhidewhenused="false" name="Light Shading Accent 3">   <w:lsdexception locked="false" priority="61" semihidden="false" unhidewhenused="false" name="Light List Accent 3">   <w:lsdexception locked="false" priority="62" semihidden="false" unhidewhenused="false" name="Light Grid Accent 3">   <w:lsdexception locked="false" priority="63" semihidden="false" unhidewhenused="false" name="Medium Shading 1 Accent 3">   <w:lsdexception locked="false" priority="64" semihidden="false" unhidewhenused="false" name="Medium Shading 2 Accent 3">   <w:lsdexception locked="false" priority="65" semihidden="false" unhidewhenused="false" name="Medium List 1 Accent 3">   <w:lsdexception locked="false" priority="66" semihidden="false" unhidewhenused="false" name="Medium List 2 Accent 3">   <w:lsdexception locked="false" priority="67" semihidden="false" unhidewhenused="false" name="Medium Grid 1 Accent 3">   <w:lsdexception locked="false" priority="68" semihidden="false" unhidewhenused="false" name="Medium Grid 2 Accent 3">   <w:lsdexception locked="false" priority="69" semihidden="false" unhidewhenused="false" name="Medium Grid 3 Accent 3">   <w:lsdexception locked="false" priority="70" semihidden="false" unhidewhenused="false" name="Dark List Accent 3">   <w:lsdexception locked="false" priority="71" semihidden="false" unhidewhenused="false" name="Colorful Shading Accent 3">   <w:lsdexception locked="false" priority="72" semihidden="false" unhidewhenused="false" name="Colorful List Accent 3">   <w:lsdexception locked="false" priority="73" semihidden="false" unhidewhenused="false" name="Colorful Grid Accent 3">   <w:lsdexception locked="false" priority="60" semihidden="false" unhidewhenused="false" name="Light Shading Accent 4">   <w:lsdexception locked="false" priority="61" semihidden="false" unhidewhenused="false" name="Light List Accent 4">   <w:lsdexception locked="false" priority="62" semihidden="false" unhidewhenused="false" name="Light Grid Accent 4">   <w:lsdexception locked="false" priority="63" semihidden="false" unhidewhenused="false" name="Medium Shading 1 Accent 4">   <w:lsdexception locked="false" priority="64" semihidden="false" unhidewhenused="false" name="Medium Shading 2 Accent 4">   <w:lsdexception locked="false" priority="65" semihidden="false" unhidewhenused="false" name="Medium List 1 Accent 4">   <w:lsdexception locked="false" priority="66" semihidden="false" unhidewhenused="false" name="Medium List 2 Accent 4">   <w:lsdexception locked="false" priority="67" semihidden="false" unhidewhenused="false" name="Medium Grid 1 Accent 4">   <w:lsdexception locked="false" priority="68" semihidden="false" unhidewhenused="false" name="Medium Grid 2 Accent 4">   <w:lsdexception locked="false" priority="69" semihidden="false" unhidewhenused="false" name="Medium Grid 3 Accent 4">   <w:lsdexception locked="false" priority="70" semihidden="false" unhidewhenused="false" name="Dark List Accent 4">   <w:lsdexception locked="false" priority="71" semihidden="false" unhidewhenused="false" name="Colorful Shading Accent 4">   <w:lsdexception locked="false" priority="72" semihidden="false" unhidewhenused="false" name="Colorful List Accent 4">   <w:lsdexception locked="false" priority="73" semihidden="false" unhidewhenused="false" name="Colorful Grid Accent 4">   <w:lsdexception locked="false" priority="60" semihidden="false" unhidewhenused="false" name="Light Shading Accent 5">   <w:lsdexception locked="false" priority="61" semihidden="false" unhidewhenused="false" name="Light List Accent 5">   <w:lsdexception locked="false" priority="62" semihidden="false" unhidewhenused="false" name="Light Grid Accent 5">   <w:lsdexception locked="false" priority="63" semihidden="false" unhidewhenused="false" name="Medium Shading 1 Accent 5">   <w:lsdexception locked="false" priority="64" semihidden="false" unhidewhenused="false" name="Medium Shading 2 Accent 5">   <w:lsdexception locked="false" priority="65" semihidden="false" unhidewhenused="false" name="Medium List 1 Accent 5">   <w:lsdexception locked="false" priority="66" semihidden="false" unhidewhenused="false" name="Medium List 2 Accent 5">   <w:lsdexception locked="false" priority="67" semihidden="false" unhidewhenused="false" name="Medium Grid 1 Accent 5">   <w:lsdexception locked="false" priority="68" semihidden="false" unhidewhenused="false" name="Medium Grid 2 Accent 5">   <w:lsdexception locked="false" priority="69" semihidden="false" unhidewhenused="false" name="Medium Grid 3 Accent 5">   <w:lsdexception locked="false" priority="70" semihidden="false" unhidewhenused="false" name="Dark List Accent 5">   <w:lsdexception locked="false" priority="71" semihidden="false" unhidewhenused="false" name="Colorful Shading Accent 5">   <w:lsdexception locked="false" priority="72" semihidden="false" unhidewhenused="false" name="Colorful List Accent 5">   <w:lsdexception locked="false" priority="73" semihidden="false" unhidewhenused="false" name="Colorful Grid Accent 5">   <w:lsdexception locked="false" priority="60" semihidden="false" unhidewhenused="false" name="Light Shading Accent 6">   <w:lsdexception locked="false" priority="61" semihidden="false" unhidewhenused="false" name="Light List Accent 6">   <w:lsdexception locked="false" priority="62" semihidden="false" unhidewhenused="false" name="Light Grid Accent 6">   <w:lsdexception locked="false" priority="63" semihidden="false" unhidewhenused="false" name="Medium Shading 1 Accent 6">   <w:lsdexception locked="false" priority="64" semihidden="false" unhidewhenused="false" name="Medium Shading 2 Accent 6">   <w:lsdexception locked="false" priority="65" semihidden="false" unhidewhenused="false" name="Medium List 1 Accent 6">   <w:lsdexception locked="false" priority="66" semihidden="false" unhidewhenused="false" name="Medium List 2 Accent 6">   <w:lsdexception locked="false" priority="67" semihidden="false" unhidewhenused="false" name="Medium Grid 1 Accent 6">   <w:lsdexception locked="false" priority="68" semihidden="false" unhidewhenused="false" name="Medium Grid 2 Accent 6">   <w:lsdexception locked="false" priority="69" semihidden="false" unhidewhenused="false" name="Medium Grid 3 Accent 6">   <w:lsdexception locked="false" priority="70" semihidden="false" unhidewhenused="false" name="Dark List Accent 6">   <w:lsdexception locked="false" priority="71" semihidden="false" unhidewhenused="false" name="Colorful Shading Accent 6">   <w:lsdexception locked="false" priority="72" semihidden="false" unhidewhenused="false" name="Colorful List Accent 6">   <w:lsdexception locked="false" priority="73" semihidden="false" unhidewhenused="false" name="Colorful Grid Accent 6">   <w:lsdexception locked="false" priority="19" semihidden="false" unhidewhenused="false" qformat="true" name="Subtle Emphasis">   <w:lsdexception locked="false" priority="21" semihidden="false" unhidewhenused="false" qformat="true" name="Intense Emphasis">   <w:lsdexception locked="false" priority="31" semihidden="false" unhidewhenused="false" qformat="true" name="Subtle Reference">   <w:lsdexception locked="false" priority="32" semihidden="false" unhidewhenused="false" qformat="true" name="Intense Reference">   <w:lsdexception locked="false" priority="33" semihidden="false" unhidewhenused="false" qformat="true" name="Book Title">   <w:lsdexception locked="false" priority="37" name="Bibliography">   <w:lsdexception locked="false" priority="39" qformat="true" name="TOC Heading">  </w:LatentStyles> </xml><![endif]--><style> <!--  /* Font Definitions */  @font-face  {font-family:"Cambria Math";  panose-1:2 4 5 3 5 4 6 3 2 4;  mso-font-charset:1;  mso-generic-font-family:roman;  mso-font-format:other;  mso-font-pitch:variable;  mso-font-signature:0 0 0 0 0 0;} @font-face  {font-family:Calibri;  panose-1:2 15 5 2 2 2 4 3 2 4;  mso-font-charset:0;  mso-generic-font-family:swiss;  mso-font-pitch:variable;  mso-font-signature:-1610611985 1073750139 0 0 159 0;}  /* Style Definitions */  p.MsoNormal, li.MsoNormal, div.MsoNormal  {mso-style-unhide:no;  mso-style-qformat:yes;  mso-style-parent:"";  margin-top:0cm;  margin-right:0cm;  margin-bottom:10.0pt;  margin-left:0cm;  line-height:115%;  mso-pagination:widow-orphan;  font-size:11.0pt;  font-family:"Calibri","sans-serif";  mso-ascii-font-family:Calibri;  mso-ascii-theme-font:minor-latin;  mso-fareast-font-family:Calibri;  mso-fareast-theme-font:minor-latin;  mso-hansi-font-family:Calibri;  mso-hansi-theme-font:minor-latin;  mso-bidi-font-family:"Times New Roman";  mso-bidi-theme-font:minor-bidi;} .MsoChpDefault  {mso-style-type:export-only;  mso-default-props:yes;  mso-ascii-font-family:Calibri;  mso-ascii-theme-font:minor-latin;  mso-fareast-font-family:Calibri;  mso-fareast-theme-font:minor-latin;  mso-hansi-font-family:Calibri;  mso-hansi-theme-font:minor-latin;  mso-bidi-font-family:"Times New Roman";  mso-bidi-theme-font:minor-bidi;} .MsoPapDefault  {mso-style-type:export-only;  margin-bottom:10.0pt;  line-height:115%;} @page Section1  {size:612.0pt 792.0pt;  margin:72.0pt 72.0pt 72.0pt 72.0pt;  mso-header-margin:35.4pt;  mso-footer-margin:35.4pt;  mso-paper-source:0;} div.Section1  {page:Section1;} --> </style><!--[if gte mso 10]> <style>  /* Style Definitions */  table.MsoNormalTable  {mso-style-name:"Table Normal";  mso-tstyle-rowband-size:0;  mso-tstyle-colband-size:0;  mso-style-noshow:yes;  mso-style-priority:99;  mso-style-qformat:yes;  mso-style-parent:"";  mso-padding-alt:0cm 5.4pt 0cm 5.4pt;  mso-para-margin-top:0cm;  mso-para-margin-right:0cm;  mso-para-margin-bottom:10.0pt;  mso-para-margin-left:0cm;  line-height:115%;  mso-pagination:widow-orphan;  font-size:11.0pt;  font-family:"Calibri","sans-serif";  mso-ascii-font-family:Calibri;  mso-ascii-theme-font:minor-latin;  mso-fareast-font-family:"Times New Roman";  mso-fareast-theme-font:minor-fareast;  mso-hansi-font-family:Calibri;  mso-hansi-theme-font:minor-latin;} </style> <![endif]-->  <p class="MsoNormal" style="margin-bottom: 0.0001pt; line-height: normal;"><span style="font-size: 10pt; font-family: &quot;Courier New&quot;; color: blue;">Select</span><span style="font-size: 10pt; font-family: &quot;Courier New&quot;;"> <o:p></o:p></span></p>  <p class="MsoNormal" style="margin-bottom: 0.0001pt; line-height: normal;"><span style="font-size: 10pt; font-family: &quot;Courier New&quot;;"><span style="">      </span>listing<span style="color: gray;">.</span>list_id<span style="color: gray;">,</span> <o:p></o:p></span></p>  <p class="MsoNormal" style="margin-bottom: 0.0001pt; line-height: normal;"><span style="font-size: 10pt; font-family: &quot;Courier New&quot;;"><span style="">      </span>listing<span style="color: gray;">.</span>company_name<span style="color: gray;">,</span> <o:p></o:p></span></p>  <p class="MsoNormal" style="margin-bottom: 0.0001pt; line-height: normal;"><span style="font-size: 10pt; font-family: &quot;Courier New&quot;;"><span style="">      </span>listing<span style="color: gray;">.</span>company_description<span style="color: gray;">,</span> <o:p></o:p></span></p>  <p class="MsoNormal" style="margin-bottom: 0.0001pt; line-height: normal;"><span style="font-size: 10pt; font-family: &quot;Courier New&quot;;"><span style="">      </span>listing<span style="color: gray;">.</span>url<span style="color: gray;">,</span> <o:p></o:p></span></p>  <p class="MsoNormal" style="margin-bottom: 0.0001pt; line-height: normal;"><span style="font-size: 10pt; font-family: &quot;Courier New&quot;;"><span style="">      </span><span style="color: fuchsia;">Coalesce</span><span style="color: gray;">(</span>county<span style="color: gray;">.</span>County_name<span style="color: gray;">,</span> country<span style="color: gray;">.</span>Country_Name<span style="color: gray;">)</span> <span style="color: blue;">As</span> County_name<span style="color: gray;">,<o:p></o:p></span></span></p>  <p class="MsoNormal" style="margin-bottom: 0.0001pt; line-height: normal;"><span style="font-size: 10pt; font-family: &quot;Courier New&quot;;"><span style="">      </span>prefs<span style="color: gray;">.</span>review_approval<span style="color: gray;">,</span> <o:p></o:p></span></p>  <p class="MsoNormal" style="margin-bottom: 0.0001pt; line-height: normal;"><span style="font-size: 10pt; font-family: &quot;Courier New&quot;;"><span style="">      </span>listing<span style="color: gray;">.</span>Country_ID<span style="color: gray;">,<o:p></o:p></span></span></p>  <p class="MsoNormal" style="margin-bottom: 0.0001pt; line-height: normal;"><span style="font-size: 10pt; font-family: &quot;Courier New&quot;;"><span style="">      </span>dbo<span style="color: gray;">.</span>funcGetRatingSum <span style="color: gray;">(</span>listing<span style="color: gray;">.</span>list_id<span style="color: gray;">)</span> <span style="color: blue;">as</span> ratingSum<span style="color: gray;">,</span> <o:p></o:p></span></p>  <p class="MsoNormal" style="margin-bottom: 0.0001pt; line-height: normal;"><span style="font-size: 10pt; font-family: &quot;Courier New&quot;;"><span style="">      </span>dbo<span style="color: gray;">.</span>funcGetRatingCount <span style="color: gray;">(</span>listing<span style="color: gray;">.</span>list_id<span style="color: gray;">)</span> <span style="color: blue;">as</span> totalCount<span style="color: gray;">,<o:p></o:p></span></span></p>  <p class="MsoNormal" style="margin-bottom: 0.0001pt; line-height: normal;"><span style="font-size: 10pt; font-family: &quot;Courier New&quot;;"><span style="">      </span><span style="color: fuchsia;">Coalesce</span><span style="color: gray;">((</span><span style="color: blue;">select</span> <span style="color: blue;">top</span> 1 banner_path <span style="color: blue;">from</span> tbl_banners <span style="color: blue;">where</span> list_id <span style="color: gray;">=</span> listing<span style="color: gray;">.</span>list_id<span style="">  </span><span style="color: gray;">and</span> listing<span style="color: gray;">.</span>subscription_id <span style="color: gray;">=</span> 2<span style="color: gray;">),</span> <span style="color: red;">''</span><span style="color: gray;">)</span> <span style="color: blue;">as</span> bannerpath <o:p></o:p></span></p>  <p class="MsoNormal" style="margin-bottom: 0.0001pt; line-height: normal;"><span style="font-size: 10pt; font-family: &quot;Courier New&quot;; color: blue;">FROM</span><span style="font-size: 10pt; font-family: &quot;Courier New&quot;;"><span style="">  </span><o:p></o:p></span></p>  <p class="MsoNormal" style="margin-bottom: 0.0001pt; line-height: normal;"><span style="font-size: 10pt; font-family: &quot;Courier New&quot;;">tbl_directorylisting listing <o:p></o:p></span></p>  <p class="MsoNormal" style="margin-bottom: 0.0001pt; line-height: normal;"><span style="font-size: 10pt; font-family: &quot;Courier New&quot;;"><span style="">      </span><span style="color: gray;">Inner</span> <span style="color: gray;">Join</span> tbl_preferences<span style="">  </span>prefs<o:p></o:p></span></p>  <p class="MsoNormal" style="margin-bottom: 0.0001pt; line-height: normal;"><span style="font-size: 10pt; font-family: &quot;Courier New&quot;;"><span style="">            </span><span style="color: blue;">On</span> listing<span style="color: gray;">.</span>company_id <span style="color: gray;">=</span> prefs<span style="color: gray;">.</span>company_id <o:p></o:p></span></p>  <p class="MsoNormal" style="margin-bottom: 0.0001pt; line-height: normal;"><span style="font-size: 10pt; font-family: &quot;Courier New&quot;;"><span style="">      </span><span style="color: gray;">Inner</span> <span style="color: gray;">Join</span> tbl_companymaster company<o:p></o:p></span></p>  <p class="MsoNormal" style="margin-bottom: 0.0001pt; line-height: normal;"><span style="font-size: 10pt; font-family: &quot;Courier New&quot;;"><span style="">            </span><span style="color: blue;">On</span> listing<span style="color: gray;">.</span>company_id<span style="color: gray;"> =</span> company<span style="color: gray;">.</span>company_id<o:p></o:p></span></p>  <p class="MsoNormal" style="margin-bottom: 0.0001pt; line-height: normal;"><span style="font-size: 10pt; font-family: &quot;Courier New&quot;;"><span style="">      </span><span style="color: gray;">Left</span> <span style="color: gray;">Outer</span> <span style="color: gray;">Join</span> tbl_county county<o:p></o:p></span></p>  <p class="MsoNormal" style="margin-bottom: 0.0001pt; line-height: normal;"><span style="font-size: 10pt; font-family: &quot;Courier New&quot;;"><span style="">            </span><span style="color: blue;">On</span> listing<span style="color: gray;">.</span>county_id <span style="color: gray;">=</span> county<span style="color: gray;">.</span>county_id<o:p></o:p></span></p>  <p class="MsoNormal" style="margin-bottom: 0.0001pt; line-height: normal;"><span style="font-size: 10pt; font-family: &quot;Courier New&quot;;"><span style="">      </span><span style="color: gray;">Inner</span> <span style="color: gray;">Join</span> tbl_country country<o:p></o:p></span></p>  <p class="MsoNormal" style="margin-bottom: 0.0001pt; line-height: normal;"><span style="font-size: 10pt; font-family: &quot;Courier New&quot;;"><span style="">            </span><span style="color: blue;">On</span> listing<span style="color: gray;">.</span>country_id <span style="color: gray;">=</span> country<span style="color: gray;">.</span>country_id<o:p></o:p></span></p>  <p class="MsoNormal" style="margin-bottom: 0.0001pt; line-height: normal;"><span style="font-size: 10pt; font-family: &quot;Courier New&quot;; color: blue;">where</span><span style="font-size: 10pt; font-family: &quot;Courier New&quot;;"> listing<span style="color: gray;">.</span>status <span style="color: gray;">=</span> 1 <o:p></o:p></span></p>  <p class="MsoNormal" style="margin-bottom: 0.0001pt; line-height: normal;"><span style="font-size: 10pt; font-family: &quot;Courier New&quot;; color: gray;">And</span><span style="font-size: 10pt; font-family: &quot;Courier New&quot;;"> company<span style="color: gray;">.</span>category_id<span style="color: gray;">=</span> @</span><span style="font-size: 10pt; font-family: &quot;Courier New&quot;;">CategoryID</span></p>  <p class="MsoNormal" style="margin-bottom: 0.0001pt; line-height: normal;"><span style="font-size: 10pt; font-family: &quot;Courier New&quot;; color: gray;">and</span><span style="font-size: 10pt; font-family: &quot;Courier New&quot;;"> listing<span style="color: gray;">.</span>subscription_id <span style="color: gray;">in</span> <span style="color: gray;">(</span>2<span style="color: gray;">,</span>3<span style="color: gray;">)<o:p></o:p></span></span></p>  <p class="MsoNormal" style="margin-bottom: 0.0001pt; line-height: normal;"><span style="font-size: 10pt; font-family: &quot;Courier New&quot;; color: gray;">and</span><span style="font-size: 10pt; font-family: &quot;Courier New&quot;;"> listing<span style="color: gray;">.</span>subscription_date <span style="color: gray;">>=</span> <span style="color: gray;">(</span><span style="color: fuchsia;">dateadd</span><span style="color: gray;">(</span><span style="color: fuchsia;">year</span><span style="color: gray;">,-</span>1<span style="color: gray;">,</span><span style="color: fuchsia;">getdate</span><span style="color: gray;">()))</span> <o:p></o:p></span></p>  <p class="MsoNormal"><span style="font-size: 10pt; line-height: 115%; font-family: &quot;Courier New&quot;; color: blue;">Order</span><span style="font-size: 10pt; line-height: 115%; font-family: &quot;Courier New&quot;;"> <span style="color: blue;">by</span><span style="">  </span>county_name<span style="color: gray;">,</span> listing<span style="color: gray;">.</span>subscription_id <span style="color: blue;">asc</span><span style="color: gray;">,</span> listing<span style="color: gray;">.</span>date_fee_paid</span></p>  Firstly you'll notice the second query is far easier to read (hopefully). I dont stand for the <span style="font-style: italic;">old skool</span> method of joining tables, join with a join and it's obvious what is going on, plus it prepares isolation of results for the where clause afterwards.<br /><br />Secondly there are fewer joins in the Column definition part of the select. I have included one of the original selects, because when optimizing the stored procedure it was siginificantly fast enough to use <span style="font-size: 10pt; font-family: &quot;Courier New&quot;;"><span style="color: gray;"></span><span style="color: blue;">select</span> <span style="color: blue;">top</span> 1</span> ... than it was to<span style="font-size: 10pt; font-family: &quot;Courier New&quot;;"><span style="color: gray;"> Left</span> <span style="color: gray;">Outer</span> <span style="color: gray;">Join</span></span>. I did however <span style="font-size: 10pt; font-family: &quot;Courier New&quot;;"><span style=""></span><span style="color: fuchsia;">Coalesce</span><span style="color: gray;"> </span></span>so that the <span style="font-size: 10pt; font-family: &quot;Courier New&quot;;"><span style="color: blue;">case</span> <span style="color: blue;"></span></span>statement didn't repeat iteself.<br /><br />What do you think? Is that better or worse?
</div>
<div class="css-full-comments-content js-full-comments-content">
<div class="css-full-comment js-full-comment">
  <div class="css-comment-user-link js-comment-user-link">
  <a href="http://www.blogger.com/profile/13629895214685690508">
  <div class="css-comment-name js-comment-name">
    Oliver
  </div>
  </a>
  <div class="css-comment-date js-comment-date">
    2009-08-18T10:49:49.736Z
  </div>
  </div>
  <div class="css-comment-content js-comment-content">
    Geek
  </div>
  <br/>
</div>
</div>
</div>


            <div class="footer">
              <div class="contact">
                <p>
                  Name<br />
                  What You Are<br />
                  digiguru@gmail.com
                </p>
              </div>
              <div class="contact">
                <p>
                  <a href="http://github.com/digiguru/">github.com/digiguru</a><br />
                  <a href="http://twitter.com/thedigiguru/">twitter.com/thedigiguru</a><br />
                </p>
              </div>
            </div>
          </div>
        </div> <!-- /container -->

    </body>
</html>
