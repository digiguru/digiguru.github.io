<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
        <title>Tracking scroll depth of elements in javascript</title>
        <meta name="viewport" content="width=device-width">

        <link href='http://fonts.googleapis.com/css?family=Audiowide' rel='stylesheet' type='text/css'>
        
        <!-- syntax highlighting CSS -->
        <link rel="stylesheet" href="/css/syntax.css">

        <!-- Custom CSS -->
        <link rel="stylesheet" href="/css/main.css">

    </head>
    <body>

        <div class="container">
          <div class="site">
            <div class="header">
              <h1 class="title"><a href="/">Digiguru.co.uk</a></h1>
              <a class="extra" href="/">home</a>
            </div>

                <h2>Tracking scroll depth of elements in javascript</h2>
<p class="meta">23 Mar 2015</p>

<div class="post">
<p>I wanted to make a plug that looked at what elements the user had scrolled into view for tracking purposes. Firstly we need to be able to capture when a user is scrolling on the page.</p>

<div class="highlight"><pre><code class="language-javascript" data-lang="javascript">(function() {
    var x =0;
    $(window).on(&quot;scroll&quot;, function() {
        x++;
        console.log(&quot;Scroll has been called &quot; + x + &quot; times&quot;);
    });
}());</code></pre></div>

<p>Run this in a console window on any page with jQuery and the event fires thousands of times (every frame where jquery realises the user is scrolling)</p>

<p>If we add a throttle function to the page, like <a href="http://benalman.com/projects/jquery-throttle-debounce-plugin/ ">Throttle / Debounce from Ben Alman</a> then we can fire the eventevery so often so the javascrip isn’t overrun.</p>

<div class="highlight"><pre><code class="language-javascript" data-lang="javascript">(function() {
    var x = 0;
    $(window).on(&quot;scroll&quot;, $.throttle( 1000, function() { 
        x++;
        console.log(&quot;Scroll has been called &quot; + x + &quot; times&quot;);
    }));
}());</code></pre></div>

<p>Now we can test every second how far the user has scrolled - but we only trigger it if the user has continued scrolling. Now we should determine how far down the page the user has scrolled.</p>

<div class="highlight"><pre><code class="language-javascript" data-lang="javascript">(function() {
    var $window = $(window),
        docHeight = $(document).height(),
        winHeight = window.innerHeight || $window.height();
    $window.on(&quot;scroll&quot;, $.throttle( 1000, function() { 
        var scrollDistance = $window.scrollTop() + winHeight;
        x++;
        console.log(&quot; scroll is at  &quot; + scrollDistance);
    }));
}());</code></pre></div>

<p>But we needn’t log every time we scroll - only when we get further down the page.</p>

<div class="highlight"><pre><code class="language-javascript" data-lang="javascript">(function() {
    var maxScrollDistnace = 0,
        $window = $(window),
        docHeight = $(document).height(),
        winHeight = window.innerHeight || $window.height();
    $window.on(&quot;scroll&quot;, $.throttle( 1000, function() { 
        var scrollDistance = $window.scrollTop() + winHeight;
        if(scrollDistance &gt; maxScrollDistnace) {
            maxScrollDistnace = scrollDistance;
            console.log(&quot;scroll got as far down as... &quot; + maxScrollDistnace);
        }
    }));
}());</code></pre></div>

<p>Now we want to check against a list of elements to see if they have become visible in the page. It’s probably best at this moment to make this a jquery plugin, as we need to pass in a selector element.</p>

<div class="highlight"><pre><code class="language-javascript" data-lang="javascript">(function ( $ ) {
    $.fn.scrollLog = function(options) {
        var $window = $(window),
            docHeight = $(document).height(),
            winHeight = window.innerHeight || $window.height(),
            maxScrollDistnace = 0,
            selector = (options &amp;&amp; options.selector) || &quot;article&quot;,
            onLog = $.isFunction(options.onLog) ? options.onLog : function(e) {
                console.log(&quot;Scrolled to &quot; + $(e).attr(&quot;class&quot;));
            },
            elements = $(selector);
        $window.on(&quot;scroll&quot;, $.throttle( 1000, function() { 
            var scrollDistance = $window.scrollTop() + winHeight;
            if(scrollDistance &gt; maxScrollDistnace) {
                maxScrollDistnace = scrollDistance;
                $.each(elements, function(index, e) {
                    if(!$(e).data(&quot;hasBeenSeen&quot;)) {
                        if ( scrollDistance &gt;= $(e).offset().top ) {
                            $(e).data(&quot;hasBeenSeen&quot;, true);
                            onLog(e);
                        }
                    }
                });


            }
        }));
    };
}( jQuery ));</code></pre></div>

<p>Now apply this to any page using the following line:</p>

<div class="highlight"><pre><code class="language-javascript" data-lang="javascript">$.fn.scrollLog();</code></pre></div>

<p>And it will tell you in console.log every time you scroll one of your “article” html elements into the view.</p>

<p>Other examples would be, if you wanted fire an ajax call to record the id every time you got scrolled a list item of type SearchResult into view, you can use this…</p>

<div class="highlight"><pre><code class="language-javascript" data-lang="javascript">$.fn.scrollLog({
    selector:&quot;li.searchResult&quot;,
    onLog:function(e) {
        var id = $(e).id;
        $.ajax(&quot;/user/viewed/&quot; + id);
    }
});</code></pre></div>

<p>This script could probably do with some enehancments - ie - what if the user resizes the window? If so it’d probably be best to reset the <code>docHeight</code>, <code>winHeight</code> &amp; <code>maxScrollDistnace</code> parameters to make sure we reset where the user has got to for responsive layouts.</p>

<p>I have done a little bit of research and it seems there are some interesting exxamples of similar work online, like <a href="http://scrolldepth.parsnip.io/">Scrolldepth</a> which is intended for Google Analaytics tracking.</p>


</div>


              
              
              <div id="disqus_thread"></div>
              
            <div class="footer">
              <div class="contact">
                <p>
                  Adam Hall<br />
                  Web Developer<br />
                  digiguru@gmail.com
                </p>
              </div>
              <div class="contact">
                <p>
                  <a href="http://github.com/digiguru/">github.com/digiguru</a><br />
                  <a href="http://twitter.com/thedigiguru/">twitter.com/thedigiguru</a><br />
                </p>
              </div>
            </div>
          </div>
        </div> <!-- /container -->

<script>
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-123008-9', 'digiguru.co.uk');
ga('require', 'linkid', 'linkid.js');
ga('send', 'pageview');

</script>
        
<script type="text/javascript">
    var disqus_shortname = 'digigurucouk';
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
        
  
    </body>
</html>
