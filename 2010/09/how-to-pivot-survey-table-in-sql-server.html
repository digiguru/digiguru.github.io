<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
        <title>How to Pivot a survey table in SQL Server and return percentages in the columns</title>
        <meta name="viewport" content="width=device-width">

        <link href='http://fonts.googleapis.com/css?family=Audiowide' rel='stylesheet' type='text/css'>
        
        <!-- syntax highlighting CSS -->
        <link rel="stylesheet" href="/css/syntax.css">

        <!-- Custom CSS -->
        <link rel="stylesheet" href="/css/main.css">

    </head>
    <body>

        <div class="container">
          <div class="site">
            <div class="header">
              <h1 class="title"><a href="/">Digiguru.co.uk</a></h1>
              <a class="extra" href="/">home</a>
            </div>

                <h2>How to Pivot a survey table in SQL Server and return percentages in the columns</h2>
<p class="meta">03 Sep 2010</p>

<div class="post">
<div class="css-full-post-content js-full-post-content">
I came across a problem earlier today that had me stuck for a whole lunchbreak.<br /><br />We send out yearly surveys, and our growing number of members choose weather to complete the survey. Now that we have historic data, I wanted to compare all the data of the years in one simple database query. I immediately thought of Sql Server 2005's Pivot command. <br /><br />First - I will set up a temporary table that simulates a flattened view of a couple of fake questions in the survey. The actual tables are very denormalised, but this represents just the data I was trying to analyse.<br /><br /><div><span style="font-family: Courier New; font-size: 10pt;"><br /><span style="color: blue; ">DECLARE</span>&nbsp;<span style="color: #8000FF; ">@Survey</span>&nbsp;<span style="color: blue; ">TABLE</span>&nbsp;<span style="color: maroon; ">(</span><br />&nbsp;&nbsp;<span style="color: maroon; ">surveyname</span>&nbsp;<span style="color: black; font-style: italic; ">VARCHAR</span><span style="color: maroon; ">(</span><span style="color: black; ">50</span><span style="color: maroon; ">)</span><span style="color: silver; ">,</span><br />&nbsp;&nbsp;<span style="color: maroon; ">username</span>&nbsp;&nbsp;&nbsp;<span style="color: black; font-style: italic; ">VARCHAR</span><span style="color: maroon; ">(</span><span style="color: black; ">50</span><span style="color: maroon; ">)</span><span style="color: silver; ">,</span><br />&nbsp;&nbsp;<span style="color: maroon; ">question</span>&nbsp;&nbsp;&nbsp;<span style="color: black; font-style: italic; ">VARCHAR</span><span style="color: maroon; ">(</span><span style="color: black; ">255</span><span style="color: maroon; ">)</span><span style="color: silver; ">,</span><br />&nbsp;&nbsp;<span style="color: maroon; ">answer</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: black; font-style: italic; ">VARCHAR</span><span style="color: maroon; ">(</span><span style="color: black; ">50</span><span style="color: maroon; ">)</span><span style="color: maroon; ">)</span><br /><br /><span style="color: blue; ">INSERT</span>&nbsp;<span style="color: blue; ">INTO</span>&nbsp;<span style="color: #8000FF; ">@Survey</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: maroon; ">(</span><span style="color: maroon; ">surveyname</span><span style="color: silver; ">,</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: maroon; ">username</span><span style="color: silver; ">,</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: maroon; ">question</span><span style="color: silver; ">,</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: maroon; ">answer</span><span style="color: maroon; ">)</span><br /><span style="color: blue; ">SELECT</span>&nbsp;<span style="color: red; ">'2008'</span><span style="color: silver; ">,</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: red; ">'Fred'</span><span style="color: silver; ">,</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: red; ">'What&nbsp;sex&nbsp;are&nbsp;you?'</span><span style="color: silver; ">,</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: red; ">'Male'</span><br /><span style="color: blue; ">UNION</span>&nbsp;<span style="color: blue; ">ALL</span><br /><span style="color: blue; ">SELECT</span>&nbsp;<span style="color: red; ">'2008'</span><span style="color: silver; ">,</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: red; ">'Fred'</span><span style="color: silver; ">,</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: red; ">'Where&nbsp;do&nbsp;you&nbsp;live?'</span><span style="color: silver; ">,</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: red; ">'England'</span><br /><span style="color: blue; ">UNION</span>&nbsp;<span style="color: blue; ">ALL</span><br /><span style="color: blue; ">SELECT</span>&nbsp;<span style="color: red; ">'2008'</span><span style="color: silver; ">,</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: red; ">'Susan'</span><span style="color: silver; ">,</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: red; ">'What&nbsp;sex&nbsp;are&nbsp;you?'</span><span style="color: silver; ">,</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: red; ">'Female'</span><br /><span style="color: blue; ">UNION</span>&nbsp;<span style="color: blue; ">ALL</span><br /><span style="color: blue; ">SELECT</span>&nbsp;<span style="color: red; ">'2008'</span><span style="color: silver; ">,</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: red; ">'Susan'</span><span style="color: silver; ">,</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: red; ">'Where&nbsp;do&nbsp;you&nbsp;live?'</span><span style="color: silver; ">,</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: red; ">'England'</span><br /><span style="color: blue; ">UNION</span>&nbsp;<span style="color: blue; ">ALL</span><br /><span style="color: blue; ">SELECT</span>&nbsp;<span style="color: red; ">'2009'</span><span style="color: silver; ">,</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: red; ">'Fred'</span><span style="color: silver; ">,</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: red; ">'What&nbsp;sex&nbsp;are&nbsp;you?'</span><span style="color: silver; ">,</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: red; ">'Male'</span><br /><span style="color: blue; ">UNION</span>&nbsp;<span style="color: blue; ">ALL</span><br /><span style="color: blue; ">SELECT</span>&nbsp;<span style="color: red; ">'2009'</span><span style="color: silver; ">,</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: red; ">'Fred'</span><span style="color: silver; ">,</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: red; ">'Where&nbsp;do&nbsp;you&nbsp;live?'</span><span style="color: silver; ">,</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: red; ">'England'</span><br /><span style="color: blue; ">UNION</span>&nbsp;<span style="color: blue; ">ALL</span><br /><span style="color: blue; ">SELECT</span>&nbsp;<span style="color: red; ">'2009'</span><span style="color: silver; ">,</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: red; ">'Susan'</span><span style="color: silver; ">,</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: red; ">'What&nbsp;sex&nbsp;are&nbsp;you?'</span><span style="color: silver; ">,</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: red; ">'Female'</span><br /><span style="color: blue; ">UNION</span>&nbsp;<span style="color: blue; ">ALL</span><br /><span style="color: blue; ">SELECT</span>&nbsp;<span style="color: red; ">'2009'</span><span style="color: silver; ">,</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: red; ">'Susan'</span><span style="color: silver; ">,</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: red; ">'Where&nbsp;do&nbsp;you&nbsp;live?'</span><span style="color: silver; ">,</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: red; ">'Wales'</span><br /><span style="color: blue; ">UNION</span>&nbsp;<span style="color: blue; ">ALL</span><br /><span style="color: blue; ">SELECT</span>&nbsp;<span style="color: red; ">'2009'</span><span style="color: silver; ">,</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: red; ">'Joe'</span><span style="color: silver; ">,</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: red; ">'What&nbsp;sex&nbsp;are&nbsp;you?'</span><span style="color: silver; ">,</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: red; ">'Male'</span><br /><span style="color: blue; ">UNION</span>&nbsp;<span style="color: blue; ">ALL</span><br /><span style="color: blue; ">SELECT</span>&nbsp;<span style="color: red; ">'2009'</span><span style="color: silver; ">,</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: red; ">'Joe'</span><span style="color: silver; ">,</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: red; ">'Where&nbsp;do&nbsp;you&nbsp;live?'</span><span style="color: silver; ">,</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: red; ">'Scotland'</span><br /><span style="color: blue; ">UNION</span>&nbsp;<span style="color: blue; ">ALL</span><br /><span style="color: blue; ">SELECT</span>&nbsp;<span style="color: red; ">'2010'</span><span style="color: silver; ">,</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: red; ">'Fred'</span><span style="color: silver; ">,</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: red; ">'What&nbsp;sex&nbsp;are&nbsp;you?'</span><span style="color: silver; ">,</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: red; ">'Male'</span><br /><span style="color: blue; ">UNION</span>&nbsp;<span style="color: blue; ">ALL</span><br /><span style="color: blue; ">SELECT</span>&nbsp;<span style="color: red; ">'2010'</span><span style="color: silver; ">,</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: red; ">'Fred'</span><span style="color: silver; ">,</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: red; ">'Where&nbsp;do&nbsp;you&nbsp;live?'</span><span style="color: silver; ">,</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: red; ">'England'</span><br /><span style="color: blue; ">UNION</span>&nbsp;<span style="color: blue; ">ALL</span><br /><span style="color: blue; ">SELECT</span>&nbsp;<span style="color: red; ">'2010'</span><span style="color: silver; ">,</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: red; ">'Susan'</span><span style="color: silver; ">,</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: red; ">'What&nbsp;sex&nbsp;are&nbsp;you?'</span><span style="color: silver; ">,</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: red; ">'Female'</span><br /><span style="color: blue; ">UNION</span>&nbsp;<span style="color: blue; ">ALL</span><br /><span style="color: blue; ">SELECT</span>&nbsp;<span style="color: red; ">'2010'</span><span style="color: silver; ">,</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: red; ">'Susan'</span><span style="color: silver; ">,</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: red; ">'Where&nbsp;do&nbsp;you&nbsp;live?'</span><span style="color: silver; ">,</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: red; ">'Wales'</span><br /><span style="color: blue; ">UNION</span>&nbsp;<span style="color: blue; ">ALL</span><br /><span style="color: blue; ">SELECT</span>&nbsp;<span style="color: red; ">'2010'</span><span style="color: silver; ">,</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: red; ">'Joe'</span><span style="color: silver; ">,</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: red; ">'What&nbsp;sex&nbsp;are&nbsp;you?'</span><span style="color: silver; ">,</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: red; ">'Male'</span><br /><span style="color: blue; ">UNION</span>&nbsp;<span style="color: blue; ">ALL</span><br /><span style="color: blue; ">SELECT</span>&nbsp;<span style="color: red; ">'2010'</span><span style="color: silver; ">,</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: red; ">'Joe'</span><span style="color: silver; ">,</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: red; ">'Where&nbsp;do&nbsp;you&nbsp;live?'</span><span style="color: silver; ">,</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: red; ">'Scotland'</span><br /><span style="color: blue; ">UNION</span>&nbsp;<span style="color: blue; ">ALL</span><br /><span style="color: blue; ">SELECT</span>&nbsp;<span style="color: red; ">'2010'</span><span style="color: silver; ">,</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: red; ">'Hillary'</span><span style="color: silver; ">,</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: red; ">'What&nbsp;sex&nbsp;are&nbsp;you?'</span><span style="color: silver; ">,</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: red; ">'Female'</span><br /><span style="color: blue; ">UNION</span>&nbsp;<span style="color: blue; ">ALL</span><br /><span style="color: blue; ">SELECT</span>&nbsp;<span style="color: red; ">'2010'</span><span style="color: silver; ">,</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: red; ">'Hillary'</span><span style="color: silver; ">,</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: red; ">'Where&nbsp;do&nbsp;you&nbsp;live?'</span><span style="color: silver; ">,</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: red; ">'Scotland'</span>&nbsp;<br /></span></div><br /><br />Selecting from that table shows all the data<br /><br /><div><span style="font-family: Courier New; font-size: 10pt;"><br /><span style="color: blue; ">SELECT</span>&nbsp;<span style="color: silver; ">*</span><br /><br/><span style="color: blue; ">FROM</span>&nbsp;&nbsp;&nbsp;<span style="color: #8000FF; ">@survey</span>&nbsp;<br /></span></div><br /><br />Now we want to compare how the total number of answers for each survey have changed over the years.<br /><br /><div><span style="font-family: Courier New; font-size: 10pt;"><br /><span style="color: blue; ">SELECT</span>&nbsp;<span style="color: silver; ">*</span><br /><span style="color: blue; ">FROM</span>&nbsp;&nbsp;&nbsp;<span style="color: maroon; ">(</span><span style="color: blue; ">SELECT</span>&nbsp;<span style="color: maroon; ">username</span><span style="color: silver; ">,</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: maroon; ">surveyname</span><span style="color: silver; ">,</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: maroon; ">question</span><span style="color: silver; ">,</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: maroon; ">answer</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: blue; ">FROM</span>&nbsp;&nbsp;&nbsp;<span style="color: #8000FF; ">@survey</span>&nbsp;<span style="color: maroon; ">mainsurvey</span><span style="color: maroon; ">)</span>&nbsp;<span style="color: blue; ">AS</span>&nbsp;<span style="color: maroon; ">answers</span>&nbsp;<span style="color: blue; ">PIVOT</span>&nbsp;<span style="color: maroon; ">(</span><span style="color: fuchsia; font-style: italic; ">COUNT</span><span style="color: maroon; ">(</span><span style="color: maroon; ">username</span><span style="color: maroon; ">)</span>&nbsp;<span style="color: blue; ">FOR</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: maroon; ">surveyname</span>&nbsp;<span style="color: blue; ">IN</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: maroon; ">(</span><span style="color: maroon; ">[2008]</span><span style="color: silver; ">,</span>&nbsp;<span style="color: maroon; ">[2009]</span><span style="color: silver; ">,</span>&nbsp;<span style="color: maroon; ">[2010]</span><span style="color: maroon; ">)</span><span style="color: maroon; ">)</span>&nbsp;<span style="color: blue; ">AS</span>&nbsp;<span style="color: maroon; ">pivoted</span><br /><span style="color: blue; ">ORDER</span>&nbsp;&nbsp;<span style="color: blue; ">BY</span>&nbsp;<span style="color: maroon; ">question</span>&nbsp;<br /></span></div><br /><br />Output is shown below. <br /><br /><table><thead><tr><td>Question</td><td>Answer</td><td>2008</td><td>2009</td><td>2010</td></thead><tbody><br /><tr><td>What sex are you?</td><td>Female</td><td>1</td><td>1</td><td>2</td></tr><br /><tr><td>What sex are you?</td><td>Male</td><td>1</td><td>2</td><td>2</td></tr><br /><tr><td>Where do you live?</td><td>England</td><td>2</td><td>1</td><td>1</td></tr><br /><tr><td>Where do you live?</td><td>Scotland</td><td>0</td><td>1</td><td>2</td></tr><br /><tr><td>Where do you live?</td><td>Wales</td><td>0</td><td>1</td><td>1</td></tr><br /></tbody></table><br /><br />This form of data really hard to read. It's hard to see from the table how many people have answered each question. It would be far better to use percentages for each row.<br /><br />I thought this would be easy - just put the percentage calculation in the pivot clause. I attempted to do this and just received syntax errors. After reading the spec I realised the only valid statement before the "for" tag is an aggregate function. On by adding DLLs to sql server can you add an aggregate, and I was losing confidence in the ability to display percentages. I took this opportunity to go on lunch!<br /><br />While eating it came to me. You can change the value going into the pivot to a fraction of a percentage for each survey question. That way you can sum the values and create the final percentage values.<br /><br />Full code sits below...<br /><br /><div><span style="font-family: Courier New; font-size: 10pt;"><br /><span style="color: blue; ">SELECT</span>&nbsp;<span style="color: silver; ">*</span><br /><span style="color: blue; ">FROM</span>&nbsp;&nbsp;&nbsp;<span style="color: maroon; ">(</span><span style="color: blue; ">SELECT</span>&nbsp;<span style="color: maroon; ">surveyname</span><span style="color: silver; ">,</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: maroon; ">weight</span>&nbsp;<span style="color: silver; ">=</span>&nbsp;<span style="color: black; ">100.0</span>&nbsp;<span style="color: silver; ">/</span>&nbsp;<span style="color: maroon; ">(</span><span style="color: blue; ">SELECT</span>&nbsp;<span style="color: fuchsia; font-style: italic; ">COUNT</span><span style="color: maroon; ">(</span><span style="color: blue; ">DISTINCT</span>&nbsp;<span style="color: maroon; ">username</span><span style="color: maroon; ">)</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: blue; ">FROM</span>&nbsp;&nbsp;&nbsp;<span style="color: #8000FF; ">@survey</span>&nbsp;<span style="color: maroon; ">total</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: blue; ">WHERE</span>&nbsp;&nbsp;<span style="color: maroon; ">total</span><span style="color: silver; ">.</span><span style="color: maroon; ">surveyname</span>&nbsp;<span style="color: silver; ">=</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: maroon; ">mainsurvey</span><span style="color: silver; ">.</span><span style="color: maroon; ">surveyname</span><span style="color: maroon; ">)</span><span style="color: silver; ">,</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: maroon; ">question</span><span style="color: silver; ">,</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: maroon; ">answer</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: blue; ">FROM</span>&nbsp;&nbsp;&nbsp;<span style="color: #8000FF; ">@survey</span>&nbsp;<span style="color: maroon; ">mainsurvey</span><span style="color: maroon; ">)</span>&nbsp;<span style="color: blue; ">AS</span>&nbsp;<span style="color: maroon; ">answers</span>&nbsp;<span style="color: blue; ">PIVOT</span>&nbsp;<span style="color: maroon; ">(</span><span style="color: fuchsia; font-style: italic; ">SUM</span><span style="color: maroon; ">(</span><span style="color: maroon; ">weight</span><span style="color: maroon; ">)</span>&nbsp;<span style="color: blue; ">FOR</span>&nbsp;<span style="color: maroon; ">surveyname</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: blue; ">IN</span>&nbsp;<span style="color: maroon; ">(</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: maroon; ">[2008]</span><span style="color: silver; ">,</span>&nbsp;<span style="color: maroon; ">[2009]</span><span style="color: silver; ">,</span>&nbsp;<span style="color: maroon; ">[2010]</span><span style="color: maroon; ">)</span><span style="color: maroon; ">)</span>&nbsp;<span style="color: blue; ">AS</span>&nbsp;<span style="color: maroon; ">pivoted</span><br /><span style="color: blue; ">ORDER</span>&nbsp;&nbsp;<span style="color: blue; ">BY</span>&nbsp;<span style="color: maroon; ">question</span>&nbsp;<br /></span></div><br />the result has nice percentages in it!<br /><table><thead><tr><td>Question</td><td>Answer</td><td>2008</td><td>2009</td><td>2010</td></thead><tbody><br /><tr><td>What sex are you?</td><td>Female</td><td>50.000000000000</td><td>33.333333333333</td><td>50.000000000000</td></tr><br /><tr><td>What sex are you?</td><td>Male</td><td>50.000000000000</td><td>66.666666666666</td><td>50.000000000000</td></tr><br /><tr><td>Where do you live?</td><td>England</td><td>100.000000000000</td><td>33.333333333333</td><td>25.000000000000</td></tr><br /><tr><td>Where do you live?</td><td>Scotland</td><td>NULL</td><td>33.333333333333</td><td>50.000000000000</td></tr><br /><tr><td>Where do you live?</td><td>Wales</td><td>NULL</td><td>33.333333333333</td><td>25.000000000000</td></tr><br /></tbody></table>
</div>
</div>


              
              
              <div id="disqus_thread"></div>
              
            <div class="footer">
              <div class="contact">
                <p>
                  Adam Hall<br />
                  Web Developer<br />
                  digiguru@gmail.com
                </p>
              </div>
              <div class="contact">
                <p>
                  <a href="http://github.com/digiguru/">github.com/digiguru</a><br />
                  <a href="http://twitter.com/thedigiguru/">twitter.com/thedigiguru</a><br />
                </p>
              </div>
            </div>
          </div>
        </div> <!-- /container -->

<script>
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-123008-9', 'digiguru.co.uk');
ga('require', 'linkid', 'linkid.js');
ga('send', 'pageview');

</script>
        
<script type="text/javascript">
    var disqus_shortname = 'digigurucouk';
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
        
  
    </body>
</html>
